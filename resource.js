var version = "v" + chrome.app.getDetails().version;
var general = "*{font-family:Helvetica,Arial,\"Source Han Sans CN\",\"Hiragino Sans GB\",\"Microsoft Yahei\",\"Microsoft Jhenghei\",STHeiti,verdana,sans-serif!important;}#bofqi.wide .player{width:980px}.arc-tool-bar .helper{float:right;border-left:1px solid #ddd;border-right:none;position:relative;padding:0;font-size:10px;cursor:pointer;transition:.1s all ease-in}.arc-tool-bar .helper:hover{background-color:#eee;}.arc-tool-bar .helper .title{font-size:12px;padding:0 15px;margin:0}.arc-tool-bar .helper .title .icon{width:16px;height:16px;display:inline-block;vertical-align:sub;margin-right:4px;background-image:url(" + chrome.extension.getURL("imgs/icon-32.png") + ");background-size:16px 16px;}.arc-tool-bar .helper .info{position:absolute;background-color:#fff;border:solid 1px #ddd;cursor:default;left:-1px;width:300px;min-height:60px;z-index:10;padding-bottom: 31px;transition:.2s all ease-in;opacity:0;pointer-events:none}.arc-tool-bar .helper .info.active{opacity:1;pointer-events:auto}.arc-tool-bar .helper .info .main{padding:12px;line-height:24px;font-size:12px;color:#444;}.arc-tool-bar .helper .info .main .section h3{font-weight:500}.arc-tool-bar .helper .info .main .section p{color:#666}.arc-tool-bar .helper .info .main .section p span{margin-right:8px;font-size:12px}.arc-tool-bar .helper .info .main .section a.b-btn{padding:4px 6px;line-height:14px;display:inline-block;margin:4px}.arc-tool-bar .helper .info .version{position:absolute;bottom:0;height:30px;line-height:30px;width:100%;text-align:center;border-top:solid 1px #ddd;}#helper_aera{width:240px;float:right;padding:0px 10px;}.titleNumber{cursor:pointer;text-decoration:underline;color:#1184B4;}#loading-notice{position:absolute;z-index:1000;left:50%;top:50%;width:260px;height:32px;margin-top:-66px;margin-left:-130px;line-height:20px;font-size:15px;background-image:url(" + chrome.extension.getURL("imgs/loading.gif") + ");background-repeat:no-repeat;background-position:6px 16px;padding-top:100px;text-align:center;background-color:#fff;border-radius:2px;box-shadow:0 1px 2px rgba(0,0,0,.3);transition:all .2s ease-in;}#loading-notice:hover{box-shadow:0 5px 10px rgba(0,0,0,.3);}#cancel-replacing{margin-left:20px;font-size:12px;border:solid 1px #7E0000;padding:2px 5px;vertical-align:bottom;border-radius:1px;cursor:pointer;color:#fff;background-color:#910000;background-image:-webkit-gradient(linear,0 0,0 bottom,from(#CF0000),to(#910000));background-repeat:no-repeat;}#cancel-replacing:hover{background-position-y:-8px}#cancel-replacing:active{background-position-y:-8px;box-shadow:inset 1px 1px 2px rgba(0,0,0,.2),inset 0 4px 4px rgba(0,0,0,.15);}";
var abplayer = ".ABP-Unit{position:relative;color:#fff;background:#000;font-size:16px;outline:0}.ABP-Unit.ABP-FullScreen{top:0;left:0;right:0;bottom:0;width:auto!important;height:auto!important;position:fixed;z-index:9999}.ABP-Unit .ABP-Video{position:absolute;overflow:hidden;top:0;left:0;right:0;bottom:/*72*/40px;background:#000}.ABP-Unit .ABP-Video video{width:100%;height:100%}.ABP-Unit .ABP-Video .ABP-Container{-webkit-transform:matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);transform:matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);position:absolute;display:block;overflow:hidden;margin:0;border:0;top:0;left:0;bottom:0;right:0;touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.ABP-Unit .ABP-Video .ABP-Container .cmt{-webkit-transform:matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);transform:matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);position:absolute;padding:3px 0 0;margin:0;color:#fff;font-family:SimHei,SimSun,Heiti,\"MS Mincho\",Meiryo,\"Microsoft YaHei\",monospace;font-size:25px;text-decoration:none;text-shadow:-1px 0 black,0 1px black,1px 0 black,0 -1px #000;-webkit-text-size-adjust:none;-ms-text-size-adjust:none;text-size-adjust:none;line-height:100%;letter-spacing:0;word-break:keep-all;white-space:pre}.ABP-Unit .ABP-Video .ABP-Container .cmt.noshadow{text-shadow:none}.ABP-Unit .ABP-Video .ABP-Container .cmt.rshadow{text-shadow:-1px 0 white,0 1px white,1px 0 white,0 -1px #fff}.ABP-Unit .ABP-Text{position:absolute;bottom:40px;left:0;right:0;height:30px;padding:0;border-top:1px solid #33b5e5;background:#000;opacity:.9}.ABP-Unit .ABP-Text:hover{opacity:1}.ABP-Unit .ABP-Text .ABP-SendComment{position:absolute;right:0;height:100%;line-height:30px;width:80px;text-align:center;background-color:#33b5e5;cursor:pointer;transition:background-color .2s ease-in-out}.ABP-Unit .ABP-Text .ABP-SendComment:hover{background-color:#6cf;}.ABP-Unit .ABP-Text .colorsel{position:absolute;top:0;left:0;right:0;bottom:0}.ABP-Unit .ABP-Text input[type=text]{background:0 0;border:none;padding:0 10px;margin:0;position:absolute;display:block;top:0;left:0;right:0;bottom:0;vertical-align:middle;color:#33b5e5;outline:0;font-family:monospace;height:30px;width:calc(100% - 100px);font-size:18px;box-shadow:none}.ABP-Unit .ABP-Control{position:absolute;bottom:0;left:0;right:0;background:#000;opacity:.9;border-top:1px solid #33b5e5;height:40px;-moz-user-select:-moz-none;-khtml-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.ABP-Unit .ABP-Control:hover{opacity:1}.ABP-Unit .ABP-Control .button{position:absolute;overflow:hidden;background-color:#000;width:40px;top:0;bottom:0;-webkit-transition:background-color .2s ease-in-out;transition:background-color .2s ease-in-out}.ABP-Unit .ABP-Control .button:hover{background-color:#6cf}.ABP-Unit .ABP-Control .ABP-Play{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAABQCAMAAAC5zwKfAAAAWlBMVEUAAAD9/f3////r6+v+/v77+/vw8PDz8/P7+/v7+/vw8PD8/Pzt7e339/f29vbz8/Pt7e37+/v6+vr6+vr7+/v7+/vu7u7z8/P19fXt7e36+vr4+Pj4+Pj///8vn5t6AAAAHXRSTlMAASIE/QcCDwsTGRwsqJJKOffhyD7VemTBXe/rhsFqj60AAAFiSURBVFjD7djLboMwEIVhD8OMPdxDbiSN3/81a6y2XqYVp1Kr8GeR3ScYGyzh9n4vwmr0+U8QTpU+PCWA+WWQ8hrCzBGzhCDMCrrxxJkJK2pdVHwjjFtnFh+Q+0ZZsBuR6S8/J3uvVjOCwa4eDApWMZ5HKFjHeBgMCqaOIxLMDR4MpkmCwXh4GBLMk5zAYFpujwFLywgG4+HiUWCZJBiM94dgwNIyocAySUaBZZJgML5dAgYsHTswOJ+w4NBAb/l8wy5Kb9BtM4+gjV2mhwHL9IBg3TcOCc436Au27ivoETBfsYdU30GP0fmq0IM+Tw8H3q/sgGCeHgxc380OWBeX1iGzNL29/xW5b6U/+6L1PBaGeqShCdjJiFUtI0EO3kyAIDGLMBNQVCWCbi96vW9B8Jsmzb8UTpQc51QzTakNF87empSZeR/CakuKN121tG13Sk1TV1Vtysvm7a4+F3LinvUOt8M8cqLxsD8AAAAASUVORK5CYII=);background-size:cover;left:0}.ABP-Unit .ABP-Control .ABP-Play.ABP-Pause{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAABQBAMAAAB8P++eAAAAG1BMVEUAAAD8/Pz6+vr////39/f////////////////CPtjLAAAACHRSTlMAAQX2DezK2/SvqNoAAADpSURBVEjH7dZNCoMwEAXgmdKFy4yrLpvgAbqp7otn6HkEEXLsmuJYcCIZmiIFfYtZhI8n8R+O7DJolJC0ziiPQSChjTiESEqj3Z/NPxMS5sV730FI4f2we4jbwl5cSQ28crEOUhra93QJyAQrLWzz4PAVpDBPjyi88/OOYUh4Cyvm4n0zrVmaG1sB7QLCCjwHWE9rbm5E2ehG+ORGw43oBKTiA808sFxChCgEWoNMVyEwFLe3gLwZGdlYa2GTgF0G3Pzd0/8cethrMOuTieq/DANH/jRIREYn3Rgija/aMaO2lJJUuRDR+AIEjI2R8l7g1QAAAABJRU5ErkJggg==)}.ABP-Unit .ABP-Control .ABP-FullScreen{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAABQCAMAAAC5zwKfAAAAVFBMVEUAAAD+/v7////////////////////9/f39/f3////////+/v7+/v7////+/v7////////////////+/v7+/v7+/v7+/v7+/v79/f3+/v7+/v7///9SRy03AAAAG3RSTlMA/REJgQOhpoEPl/UZpnrrvVwHco3jbUkyINGIpcPFAAABZElEQVRYw+2Y6W7DIBCEF/DFEYyP+Eje/z0btFItIwpEQnKb8vmfZxkNxkasoVAoFK5iZGfGkBSHrVN1Zlo5StwjMYjApztxuWtqJao90sQhSD30zxfkdD37oQ5JIbggdowDEfwHiZA5HJG2xA5zL0FfkiCehORGI4a+hHIZAcZFehImGTrjiBTKakrI031M2MYNLY/mQCw7ivsimoMHut7SDGd6wL/Xseb0YH7LsKohQt2hYeKUu0TD9IQfZPgPn2F7QcK8z7DBzUHHDTVWNmFDhmX9AFFwA5eaQZDNSIL7VQwlbKXZIMI2G9PtkMBeGTNvEIUrxSAJphSHTyDvlHFRqrRF6XBRsr822V/s3J9e7s2hLYZ/1vD3nxwunHKb/cCZ+0jcpnYB8UO7LSQJhljobSscu7cSehuf0920hFw4CZ3WzEmIUrx5dBMezaObEKWc7a3mORvwblpZ7l8EhUKhcBFfWwZRgtjNOgwAAAAASUVORK5CYII=);background-size:cover;right:0}.ABP-Unit .ABP-Control .ABP-CommentShow{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAABQCAMAAAC5zwKfAAAAclBMVEUAAAD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+/v7///////8j/l6tAAAAJXRSTlMAIEDUofvxc/bFaxTezKt8W1UN5b+OCDQoGOy4spRMmWIwBYqC4m3M0gAAAe9JREFUWMPtluuuoyAURsGKireqoOK92u73f8XZWCdnJpbJpHQmOQnrh1VTlgI7+5M4HA6Hw/HPSG7LwIfllnxGR/0InkQ+Jfbcdl0vgl1ZWPuuqMluHZ51hcTz2NJXALDw64oB86x8XbC/UzOHcUuqdY0Bsv1+W8TXxR85z7Ls8jsZH/0pLF8/eAIYCZkFIDnO3hsAWr1RtWAM/shLYRPo8eUxFH+SEiDcdx6v3xB6AClJ0Ap87PEoSAcwWQhDgFzvMyuwulOAgRBmJbwD1CRD61FAd7IxuNoK9UYfwpJQgNl2ypG2IhmAwjt9YyGcAVItCjzSoSLaVI8zRmhZ5/KSil6I9GKoQ2PZxEfJIDICvhFkqzqqVkSpLqnI37MAjBuHX5SWLYwGAGGVoyktGB7izbp5oeveqGJuiCrX5L7UjaXxod8uVHpB27oHVto32GdnFUIvYjB/NAJYTj8UUsU0cOnH1CXXt0uuNzEn10H1k9PArUoo9pTW89pV0aOrmJOLeuFjGgeODUyOeX09LwMtH8+mF/S9uPBRNzljcp2b7guhf27DhuSyEJqSy1J4Ti4LoSG53hQak+tdoSm5Tn8P0hfCOo3YSWhIrq86zLjMlzqe25Owa0v9EZhLKbkc/KXGOnTJ9f2Sy+FwOBz/kx8nI5AIS1+pZgAAAABJRU5ErkJggg==);background-size:cover;top:0;right:40px;bottom:0}.ABP-Unit .ABP-Control .progress-bar{position:absolute;overflow:hidden;cursor:default;top:0;right:80px;bottom:0;left:40px;background:#000}.ABP-Unit .ABP-Control .progress-bar .bar{position:absolute;left:0;top:0;bottom:0;background:#4399ee;opacity:.4}.ABP-Unit .ABP-Control .progress-bar .bar.dark{background:#09c;opacity:1}.ABP-Unit .ABP-Popup{position:absolute;background:#000;border:1px solid #33b5e5;left:10px;padding:5px;bottom:82px;opacity:.8}@font-face{font-family:\"\9ED1\4F53\";src:local('SimHei')}@font-face{font-family:\"\5B8B\4F53\";src:local('SimSun')}@font-face{font-family:\"\534E\6587\6977\4F53\";src:local('SimKai')}@font-face{font-family:\"\5E7C\5706\";src:local('YouYuan')}@font-face{font-family:\"\5FAE\8F6F\96C5\9ED1\";src:local('Microsoft YaHei')}";
var ad_fade = "#indexgg1,#indexgg2,#indexgg3,#indexgg4,#indexgg5,#indexgg6,#indexc2,.gg-ads,#topgg,.r-gg1,#listgg1,#listb1,#listb2,#listb3,#alistads,#googlegg,#arcgg3,#contgg1,.ad,clear.ad_top,#bdad,div[class^=\"ad-\"],#taobaoid{opacity:.2}#indexgg1:hover,#indexgg2:hover,#indexgg3:hover,#indexgg4:hover,#indexgg5:hover,#indexgg6:hover,#indexc2:hover,.gg-ads:hover,#topgg:hover,.r-gg1:hover,#listgg1:hover,#listb1:hover,#listb2:hover,#listb3:hover,#alistads:hover,#googlegg:hover,#arcgg3:hover,#contgg1:hover,.ad:hover,iframe[src=\"http://www.bilibili.com/bdad.html\"]:hover,iframe#cproIframe1:hover,iframe#cproIframe2:hover,iframe#cproIframe3:hover,iframe#cproIframe4:hover,.ad_top:hover,#bdad:hover,div[class^=\"ad-\"]:hover,#taobaoid:hover{opacity:1}";
var ad_kill = "#indexgg1,#indexgg2,#indexgg3,#indexgg4,#indexgg5,#indexgg6,#indexc2,.gg-ads,#topgg,.r-gg1,#listgg1,#listb1,#listb2,#listb3,#alistads,#googlegg,#arcgg3,#contgg1,.ad,iframe[src=\"http://www.bilibili.com/bdad.html\"],clear.ad_top,#bdad,div[class^=\"ad-\"],#taobaoid{display:none!important}";
var ad_mode = ".scontent{padding:0px!important;height:0px}.player-wrapper,.v_info,.container-top,.container-row,#hotbox,#index_online,.common,.rat,#special,#bofqi,.z-l,.z-r,.mobile,.c-link,.footer,.info,.upinfo,.alist,.s_center,.index-tjbox,.iv{display:none!important}.videobox{box-shadow:none!important;background:transparent!important}#indexgg1,#indexgg2,#indexgg3,#indexgg4,#indexgg5,#indexgg6,#indexc2,.gg-ads,#topgg,.r-gg1,#listgg1,#listb1,#listb2,#listb3,#alistads,#googlegg,#arcgg3,#contgg1,.ad,iframe[src=\"http://www.bilibili.com/bdad.html\"],clear#bdad,div[class^=\"ad-\"],#taobaoid{display:block!important;opacity:1!important}";
var helper = "*{font-family:Helvetica,Arial,\"Source Han Sans CN\",\"Hiragino Sans GB\",\"Microsoft Yahei\",\"Microsoft Jhenghei\",STHeiti,verdana,sans-serif!important;}.arc-tool-bar .helper{float:right;border-left:1px solid #ddd;border-right:none;position:relative;padding:0 15px;font-size:10px;cursor:pointer;}.arc-tool-bar .helper:hover{background-color:#eee;}.arc-tool-bar .helper .title{font-size:12px;}";
var defaultOptions = {
	"ad": "keep",
	"ad_opacity": 0.1,
	"dlquality": "flv",
	"dynamic": "on",
	"enabled": false,
	"replace": "on",
	"html5": "off",
	"contextmenu": "on",
	"rel_search": "without",
	"updates": 0
};
var cidCache = {};
if(localStorage.getItem('cidCache') != null) {
	try {
        cidCache = JSON.parse(localStorage.getItem('cidCache'));
    } catch (e) {
        localStorage.setItem('cidCache', null);
    }
}
function getOption(key) {
	if (localStorage.getItem(key) === null) {
		localStorage.setItem(key, defaultOptions[key]);
	}
	return localStorage.getItem(key);
}

function setOption(key, value, pushcss) {
	localStorage.setItem(key, value);
	if (pushcss) updateAll();
}

function getCSS(url) {
	var bilibili_helper_css = general + abplayer;
	var adType = getOption("ad");
	if (url.indexOf("topic") >= 0) adType = "kill";
	switch (adType) {
		case "fade":
			ad_fade = "#indexgg1,#indexgg2,#indexgg3,#indexgg4,#indexgg5,#indexgg6,#indexc2,.gg-ads,#topgg,.r-gg1,#listgg1,#listb1,#listb2,#listb3,#alistads,#googlegg,#arcgg3,#contgg1,.ad,clear.ad_top,#bdad,div[class^=\"ad-\"],#taobaoid{opacity:" + getOption("ad_opacity") + ";-webkit-transition:all .1s linear}#indexgg1:hover,#indexgg2:hover,#indexgg3:hover,#indexgg4:hover,#indexgg5:hover,#indexgg6:hover,#indexc2:hover,.gg-ads:hover,#topgg:hover,.r-gg1:hover,#listgg1:hover,#listb1:hover,#listb2:hover,#listb3:hover,#alistads:hover,#googlegg:hover,#arcgg3:hover,#contgg1:hover,.ad:hover,iframe[src=\"http://www.bilibili.com/bdad.html\"]:hover,iframe#cproIframe1:hover,iframe#cproIframe2:hover,iframe#cproIframe3:hover,iframe#cproIframe4:hover,.ad_top:hover,#bdad:hover,div[class^=\"ad-\"]:hover,#taobaoid:hover{opacity:1}";
			bilibili_helper_css += ad_fade;
			break;
		case "kill":
			bilibili_helper_css += ad_kill;
			break;
	}
	return bilibili_helper_css;
}